<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="egovframework.kaist.admin.portfolio.service.impl.AdminPortfolioMapper">
	 
	<select id="getListAll" resultType="hashMap" >
		
		SELECT /*AdminPortfolioMapper*/  TBL_PORTFOLIO.*
			,TBL_MEMBER.NAME
			,TBL_MEMBER.SCHOOL_NAME
			,TBL_MEMBER.SCHOOL_YEAR
			,TBL_MEMBER.SEX
			,TBL_MEMBER.ADDRESS_LOCAL
		FROM
			TBL_PORTFOLIO, TBL_MEMBER
		WHERE 
			TBL_PORTFOLIO.MEMBER_ID = TBL_MEMBER.MEMBER_ID
		ORDER BY MEMBER_ID

	</select>
	
	<select id="getListExcelAll" resultType="hashMap" parameterType="egovframework.kaist.admin.portfolio.model.AdminPortfolioVo" >
		
		SELECT /*AdminPortfolioMapper*/  
			  TBL_PORTFOLIO.IDX
			  ,TBL_PORTFOLIO.MEMBER_ID
			  ,TBL_PORTFOLIO.START_TM
			  ,TBL_PORTFOLIO.END_TM
			  ,TBL_PORTFOLIO.PLACE
			  ,TBL_PORTFOLIO.TEACHER
			  ,TBL_PORTFOLIO.COURSE
			  ,TBL_PORTFOLIO.COURSE_PRGM
			  ,TBL_PORTFOLIO.PRGM_NM
			  ,TBL_PORTFOLIO.STFT
			  /*,TBL_PORTFOLIO.EVALUATION*/
			  /*,TBL_PORTFOLIO.EVALUATION_TACHER*/
			  ,TBL_PORTFOLIO.EVAL_OPEN_YN
			  ,TBL_PORTFOLIO.PROF_STFT
			  ,TBL_PORTFOLIO.FILES
			  ,TBL_PORTFOLIO.CREATE_TM
			  ,TBL_PORTFOLIO.UPDATE_TM
			  ,TBL_PORTFOLIO.PROGRAM_IDX
			  ,TBL_PORTFOLIO.CONTENT
			  ,TBL_PORTFOLIO.RTICIPATION_TM

			,TBL_MEMBER.NAME
			,TBL_MEMBER.SCHOOL_NAME
			,TBL_MEMBER.SCHOOL_YEAR
			,TBL_MEMBER.SEX
			,TBL_MEMBER.ADDRESS_LOCAL
		FROM
			TBL_PORTFOLIO, TBL_MEMBER
		WHERE 
			TBL_PORTFOLIO.MEMBER_ID = TBL_MEMBER.MEMBER_ID
		<if test="YEAR != ''">
	    	AND TBL_PORTFOLIO.YEAR = #{YEAR}
	    </if>
		ORDER BY MEMBER_ID

	</select>
	
		
	<select id="getListAllMemberIdIn" resultType="hashMap"  parameterType="String">
		SELECT /*AdminPortfolioMapper*/  TBL_PORTFOLIO.*
			,TBL_MEMBER.NAME
			,TBL_MEMBER.SCHOOL_NAME
			,TBL_MEMBER.SCHOOL_YEAR
			,TBL_MEMBER.SEX
			,TBL_MEMBER.ADDRESS_LOCAL
		FROM
			TBL_PORTFOLIO, TBL_MEMBER
		WHERE 
			TBL_PORTFOLIO.MEMBER_ID IN (${value})
			AND 
				TBL_PORTFOLIO.MEMBER_ID = TBL_MEMBER.MEMBER_ID
		ORDER BY TBL_PORTFOLIO.MEMBER_ID
	</select>
	<select id="getListStat" resultType="hashMap"  parameterType="String">
		SELECT /*AdminPortfolioMapper*/
		(SELECT count(*) FROM TBL_PORTFOLIO WHERE DATE_FORMAT(CREATE_TM, '%Y') = #{value} AND COURSE_PRGM = 11) AS COURSE_PRGM_CNT_11
		,(SELECT count(*) FROM TBL_PORTFOLIO WHERE DATE_FORMAT(CREATE_TM, '%Y') = #{value} AND COURSE_PRGM = 12) AS COURSE_PRGM_CNT_12
		,(SELECT count(*) FROM TBL_PORTFOLIO WHERE DATE_FORMAT(CREATE_TM, '%Y') = #{value} AND COURSE_PRGM = 13) AS COURSE_PRGM_CNT_13
		,(SELECT count(*) FROM TBL_PORTFOLIO WHERE DATE_FORMAT(CREATE_TM, '%Y') = #{value} AND COURSE_PRGM = 14) AS COURSE_PRGM_CNT_14
		,(SELECT count(*) FROM TBL_PORTFOLIO WHERE DATE_FORMAT(CREATE_TM, '%Y') = #{value} AND COURSE_PRGM = 15) AS COURSE_PRGM_CNT_15
		,(SELECT count(*) FROM TBL_PORTFOLIO WHERE DATE_FORMAT(CREATE_TM, '%Y') = #{value} AND COURSE_PRGM = 16) AS COURSE_PRGM_CNT_16
		,(SELECT count(*) FROM TBL_PORTFOLIO WHERE DATE_FORMAT(CREATE_TM, '%Y') = #{value} AND COURSE_PRGM = 17) AS COURSE_PRGM_CNT_17
		
		,(SELECT count(*) FROM TBL_PORTFOLIO WHERE DATE_FORMAT(CREATE_TM, '%Y') = #{value} AND COURSE_PRGM = 21) AS COURSE_PRGM_CNT_21
		,(SELECT count(*) FROM TBL_PORTFOLIO WHERE DATE_FORMAT(CREATE_TM, '%Y') = #{value} AND COURSE_PRGM = 22) AS COURSE_PRGM_CNT_22
		,(SELECT count(*) FROM TBL_PORTFOLIO WHERE DATE_FORMAT(CREATE_TM, '%Y') = #{value} AND COURSE_PRGM = 23) AS COURSE_PRGM_CNT_23
		,(SELECT count(*) FROM TBL_PORTFOLIO WHERE DATE_FORMAT(CREATE_TM, '%Y') = #{value} AND COURSE_PRGM = 24) AS COURSE_PRGM_CNT_24
		,(SELECT count(*) FROM TBL_PORTFOLIO WHERE DATE_FORMAT(CREATE_TM, '%Y') = #{value} AND COURSE_PRGM = 25) AS COURSE_PRGM_CNT_25
		
		,(SELECT count(*) FROM TBL_PORTFOLIO WHERE DATE_FORMAT(CREATE_TM, '%Y') = #{value} AND COURSE_PRGM = 31) AS COURSE_PRGM_CNT_31
		,(SELECT count(*) FROM TBL_PORTFOLIO WHERE DATE_FORMAT(CREATE_TM, '%Y') = #{value} AND COURSE_PRGM = 41) AS COURSE_PRGM_CNT_41
		,(SELECT count(*) FROM TBL_PORTFOLIO WHERE DATE_FORMAT(CREATE_TM, '%Y') = #{value} AND COURSE_PRGM = 42) AS COURSE_PRGM_CNT_42
		
		,(SELECT count(DISTINCT TBL_PORTFOLIO.member_id) FROM TBL_PORTFOLIO , TBL_MEMBER WHERE TBL_PORTFOLIO.MEMBER_ID = TBL_MEMBER.MEMBER_ID AND TBL_MEMBER.SCHOOL_YEAR BETWEEN 4 AND 6 AND DATE_FORMAT(TBL_PORTFOLIO.create_tm, '%Y') = #{value}) AS COURSE_PRGM_CNT_51
		,(SELECT count(DISTINCT TBL_PORTFOLIO.member_id) FROM TBL_PORTFOLIO , TBL_MEMBER WHERE TBL_PORTFOLIO.MEMBER_ID = TBL_MEMBER.MEMBER_ID AND TBL_MEMBER.SCHOOL_YEAR BETWEEN 7 AND 9 AND DATE_FORMAT(TBL_PORTFOLIO.create_tm, '%Y') = #{value}) AS COURSE_PRGM_CNT_52
		,(SELECT count(DISTINCT TBL_PORTFOLIO.member_id) FROM TBL_PORTFOLIO , TBL_MEMBER WHERE TBL_PORTFOLIO.MEMBER_ID = TBL_MEMBER.MEMBER_ID AND TBL_MEMBER.SCHOOL_YEAR BETWEEN 10 AND 11 AND DATE_FORMAT(TBL_PORTFOLIO.create_tm, '%Y') = #{value}) AS COURSE_PRGM_CNT_53
		
		
		
		,IFNULL((SELECT SUM(RTICIPATION_TM) FROM TBL_PORTFOLIO WHERE DATE_FORMAT(CREATE_TM, '%Y') = #{value} AND COURSE_PRGM = 11),0) AS COURSE_PRGM_11
		,IFNULL((SELECT SUM(RTICIPATION_TM) FROM TBL_PORTFOLIO WHERE DATE_FORMAT(CREATE_TM, '%Y') = #{value} AND COURSE_PRGM = 12),0) AS COURSE_PRGM_12
		,IFNULL((SELECT SUM(RTICIPATION_TM) FROM TBL_PORTFOLIO WHERE DATE_FORMAT(CREATE_TM, '%Y') = #{value} AND COURSE_PRGM = 13),0) AS COURSE_PRGM_13
		,IFNULL((SELECT SUM(RTICIPATION_TM) FROM TBL_PORTFOLIO WHERE DATE_FORMAT(CREATE_TM, '%Y') = #{value} AND COURSE_PRGM = 14),0) AS COURSE_PRGM_14
		,IFNULL((SELECT SUM(RTICIPATION_TM) FROM TBL_PORTFOLIO WHERE DATE_FORMAT(CREATE_TM, '%Y') = #{value} AND COURSE_PRGM = 15),0) AS COURSE_PRGM_15
		,IFNULL((SELECT SUM(RTICIPATION_TM) FROM TBL_PORTFOLIO WHERE DATE_FORMAT(CREATE_TM, '%Y') = #{value} AND COURSE_PRGM = 16),0) AS COURSE_PRGM_16
		,IFNULL((SELECT SUM(RTICIPATION_TM) FROM TBL_PORTFOLIO WHERE DATE_FORMAT(CREATE_TM, '%Y') = #{value} AND COURSE_PRGM = 17),0) AS COURSE_PRGM_17
		
		,IFNULL((SELECT SUM(RTICIPATION_TM) FROM TBL_PORTFOLIO WHERE DATE_FORMAT(CREATE_TM, '%Y') = #{value} AND COURSE_PRGM = 21),0) AS COURSE_PRGM_21
		,IFNULL((SELECT SUM(RTICIPATION_TM) FROM TBL_PORTFOLIO WHERE DATE_FORMAT(CREATE_TM, '%Y') = #{value} AND COURSE_PRGM = 22),0) AS COURSE_PRGM_22
		,IFNULL((SELECT SUM(RTICIPATION_TM) FROM TBL_PORTFOLIO WHERE DATE_FORMAT(CREATE_TM, '%Y') = #{value} AND COURSE_PRGM = 23),0) AS COURSE_PRGM_23
		,IFNULL((SELECT SUM(RTICIPATION_TM) FROM TBL_PORTFOLIO WHERE DATE_FORMAT(CREATE_TM, '%Y') = #{value} AND COURSE_PRGM = 24),0) AS COURSE_PRGM_24
		,IFNULL((SELECT SUM(RTICIPATION_TM) FROM TBL_PORTFOLIO WHERE DATE_FORMAT(CREATE_TM, '%Y') = #{value} AND COURSE_PRGM = 25),0) AS COURSE_PRGM_25
		
		,IFNULL((SELECT SUM(RTICIPATION_TM) FROM TBL_PORTFOLIO WHERE DATE_FORMAT(CREATE_TM, '%Y') = #{value} AND COURSE_PRGM = 31),0) AS COURSE_PRGM_31
		,IFNULL((SELECT SUM(RTICIPATION_TM) FROM TBL_PORTFOLIO WHERE DATE_FORMAT(CREATE_TM, '%Y') = #{value} AND COURSE_PRGM = 41),0) AS COURSE_PRGM_41
		,IFNULL((SELECT SUM(RTICIPATION_TM) FROM TBL_PORTFOLIO WHERE DATE_FORMAT(CREATE_TM, '%Y') = #{value} AND COURSE_PRGM = 42),0) AS COURSE_PRGM_42
		

	</select>
	<!--교육과정 프로그램(11:상담,12:진로적성검사,13:학습멘토링,14:자율연구,15:융합과학 프로젝트,16:전문가멘토링,17:기타,21:현장체험학습,22:또래멘토링23:온라인 학습멘토링,24:문화체험25기타,31:캠프,41:오리엔테이션,42:성과발표회,)  -->
	<!-- 51~53 => 포트폴리오 초 , 중 , 고 별 갯수 -->	
	
	
		
	<select id="getList" resultType="hashMap" parameterType="egovframework.kaist.admin.portfolio.model.AdminPortfolioVo">
		SELECT /*ADMINPORTFOLIOMAPPER*/ *, 
		IFNULL((SELECT NAME FROM TBL_PROGRAM WHERE IDX = TBL_PORTFOLIO.PROGRAM_IDX),'')AS PROGRAM_NAME
		,IFNULL((SELECT YEAR FROM TBL_PROGRAM WHERE IDX = TBL_PORTFOLIO.PROGRAM_IDX),'')AS YEAR 
		
		FROM TBL_PORTFOLIO
		WHERE 1=1 
		<if test="MEMBER_ID != ''">
	    	AND MEMBER_ID = #{MEMBER_ID}
	    </if>
	    <if test="YEAR != ''">
	    	AND YEAR = #{YEAR}
	    </if>
		ORDER BY UPDATE_TM DESC
		
		LIMIT ${LIMIT} OFFSET ${OFFSET}
	</select>
		
	<select id="getEVAL_OPEN_Y_CNT" resultType="int" >
		SELECT /*AdminPortfolioMapper*/ count(*) FROM TBL_PORTFOLIO
		WHERE 1=1 
		AND EVAL_OPEN_YN = '1'
	</select>
	<select id="getEVAL_OPEN_N_CNT" resultType="int" >
		SELECT /*AdminPortfolioMapper*/ count(*) FROM TBL_PORTFOLIO
		WHERE 1=1 
		AND EVAL_OPEN_YN = '0'
		
	</select>
		
	<select id="getListCnt" resultType="int" parameterType="egovframework.kaist.admin.portfolio.model.AdminPortfolioVo">
		SELECT /*AdminPortfolioMapper*/ count(*) FROM TBL_PORTFOLIO
		WHERE 1=1 
		<if test="MEMBER_ID != ''">
	    	AND "MEMBER_ID" = #{MEMBER_ID}
	    </if>
	    <if test="YEAR != ''">
	    	AND YEAR = #{YEAR}
	    </if>
	</select>

	<select id="getView" resultType="egovframework.kaist.admin.portfolio.model.AdminPortfolioVo" parameterType="String">
		SELECT /*AdminPortfolioMapper*/ *
		, (SELECT NAME FROM TBL_PROGRAM WHERE IDX = TBL_PORTFOLIO.PROGRAM_IDX) AS PROGRAM_NAME
		,IFNULL((SELECT YEAR FROM TBL_PROGRAM WHERE IDX = TBL_PORTFOLIO.PROGRAM_IDX),'') AS YEAR 
		 FROM TBL_PORTFOLIO where IDX = #{value};
	</select>

	<insert id="setInsert"	parameterType="egovframework.kaist.admin.portfolio.model.AdminPortfolioVo">
		INSERT INTO /*AdminPortfolioMapper*/ TBL_PORTFOLIO (
			IDX, 
			MEMBER_ID, 
			START_TM, 
			END_TM, 
			PLACE, 
			TEACHER, 
			CONTENT, 
			EVALUATION, 
			FILES, 
			PROGRAM_IDX,
			CREATE_TM, 
			UPDATE_TM,
			EVALUATION_TACHER

	
		) VALUES (
			#{IDX}, 
			#{MEMBER_ID}, 
			#{START_TM}, 
			#{END_TM}, 
			#{PLACE}, 
			#{TEACHER}, 
			#{CONTENT}, 
			#{EVALUATION}, 
			#{FILES}, 
			#{PROGRAM_IDX},
			now(), 
			now(),
			EVALUATION_TACHER



		) 
	</insert>

	<update id="setUpdate"	parameterType="egovframework.kaist.admin.portfolio.model.AdminPortfolioVo">
		UPDATE /*AdminPortfolioMapper*/ TBL_PORTFOLIO SET 
			MEMBER_ID= #{MEMBER_ID}, 
			START_TM= #{START_TM}, 
			END_TM= #{END_TM}, 
			PLACE= #{PLACE}, 
			TEACHER= #{TEACHER}, 
			CONTENT= #{CONTENT}, 
			EVALUATION= #{EVALUATION},
			EVALUATION_TACHER= #{EVALUATION_TACHER},
			<if test="FILES != ''">
			FILES= #{FILES},
			</if>
			UPDATE_TM= now() 

		WHERE
			IDX = #{IDX} 
	</update>
	
	
	<delete id="setDelete"	parameterType="egovframework.kaist.admin.portfolio.model.AdminPortfolioVo">
		DELETE FROM /*AdminPortfolioMapper*/
			TBL_PORTFOLIO
		WHERE IDX =  #{IDX} 
	</delete>

    
</mapper>